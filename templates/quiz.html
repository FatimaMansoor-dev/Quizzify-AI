<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }
        .quiz-container {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 90%;
            max-width: 600px;
        }
        .quiz-container h1 {
            color: #4a41ff;
            margin-bottom: 20px;
        }
        .question {
            font-weight: bold;
            margin-top: 20px;
        }
        .options {
            margin: 10px 0;
        }
        .options label {
            display: block;
            margin: 5px 0;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .progress-bar {
            height: 10px;
            width: 100%;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
        }
        .progress-bar-fill {
            height: 100%;
            background: #4a41ff;
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }
        .nav-btn {
            padding: 10px 20px;
            background-color: #4a41ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .nav-btn:hover {
            background-color: #3732c1;
        }
        .result {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4a41ff;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>Math Quiz</h1>
        <div id="quiz"></div>
        <div class="progress-bar">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
        </div>
        <div class="navigation">
            <button class="nav-btn hidden" id="prev-btn" onclick="navigate(-1)">Previous</button>
            <button class="nav-btn" id="next-btn" onclick="navigate(1)">Next</button>
            <button class="nav-btn hidden" id="submit-btn" onclick="submitQuiz()">Submit</button>
        </div>
        <div class="result" id="result"></div>
    </div>

    <script>
        // Extract URL parameters
const urlParams = new URLSearchParams(window.location.search);
const message = urlParams.get("message") || "No quiz data provided.";
const email = urlParams.get("email") || "No email provided.";

// Function to parse the message into questions
function parseQuestions(message) {
    const questionBlocks = message.split(/\*\*Question \d+:\*\*/).slice(1);
    return questionBlocks.map((block) => {
        const [questionPart, answerPart] = block.split("**Answer:**");
        const questionMatch = questionPart.match(/^(.*?)\n(.*?)$/s);
        const questionText = questionMatch[1].trim();
        const options = questionMatch[2]
            .trim()
            .split("\n")
            .map((opt) => opt.trim());
        const correctAnswer = answerPart.match(/[A-D]\)/)[0][0];
        return {
            question: questionText,
            options,
            correctAnswer,
        };
    });
}

// Parse the quiz questions
const questions = parseQuestions(message);

// DOM elements and state variables
const quizContainer = document.getElementById("quiz");
const progressBarFill = document.getElementById("progress-bar-fill");
let currentQuestion = 0;

// Array to store user's answers
const userAnswers = new Array(questions.length).fill(null);

function loadQuiz(index) {
    // Load the current question and options
    quizContainer.innerHTML = `
        <div class="question">${index + 1}. ${questions[index].question}</div>
        <div class="options">
            ${questions[index].options
                .map(
                    (option, i) => `
                    <label>
                        <input type="radio" name="question${index}" value="${String.fromCharCode(65 + i)}"
                        ${userAnswers[index] === String.fromCharCode(65 + i) ? "checked" : ""} />
                        ${option}
                    </label>
                `
                )
                .join("")}
        </div>
    `;
    updateProgress();
    updateNavigation();
}

function updateProgress() {
    // Update the progress bar width
    const progress = ((currentQuestion + 1) / questions.length) * 100;
    progressBarFill.style.width = `${progress}%`;
}

function updateNavigation() {
    // Show/hide navigation buttons based on current question index
    document.getElementById("prev-btn").classList.toggle("hidden", currentQuestion === 0);
    document.getElementById("next-btn").classList.toggle(
        "hidden",
        currentQuestion === questions.length - 1
    );
    document.getElementById("submit-btn").classList.toggle(
        "hidden",
        currentQuestion !== questions.length - 1
    );
}

function navigate(direction) {
    // Save the current selection
    const selectedOption = document.querySelector(`input[name="question${currentQuestion}"]:checked`);
    if (selectedOption) {
        userAnswers[currentQuestion] = selectedOption.value;
    }

    // Navigate to the next or previous question
    currentQuestion += direction;
    loadQuiz(currentQuestion);
}

function submitQuiz() {
    let score = 0;

    // Evaluate the quiz results
    questions.forEach((q, index) => {
        const selectedAnswer = userAnswers[index];
        if (selectedAnswer) {
            if (selectedAnswer === q.correctAnswer) {
                score++;
            }
        }
    });

    // Display the result
    const resultContainer = document.getElementById("result");
    resultContainer.textContent = `You scored ${score} out of ${questions.length}!`;

    // Send results to the backend
    fetch("/insertResults", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            score: score,
            email: email,
            totalQuestions: questions.length,
            answers: questions.map((q, index) => ({
                question: q.question,
                selectedAnswer: userAnswers[index],
                correctAnswer: q.correctAnswer,
            })),
        }),
    })
        .then((response) => {
            if (response.ok) {
                window.location.href = `/userProfile?email=${email}`;
            } else {
                resultContainer.textContent = "Failed to submit your quiz. Please try again.";
            }
        })
        .catch(() => {
            resultContainer.textContent = "An error occurred. Please try again.";
        });
}

// Load the initial question
loadQuiz(currentQuestion);

    </script>
</body>
</html>
